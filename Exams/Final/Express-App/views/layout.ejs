<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Tehzeeb Bakers</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/stylesheets/style.css">
    <link rel="stylesheet"href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/>
    <link rel="icon" type="image/png" href="https://tehzeeb.com/media/favicon/stores/1/resp_logo.png">
    <link rel="shortcut icon" type="image/png" href="https://tehzeeb.com/media/favicon/stores/1/resp_logo.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <meta name="description" content="Tehzeeb is a culture, tradition, lifestyle and class of Pakistan, with a legacy of more than 114 years. Popular among Royalties and their families visiting Pakistan from all across the world.">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
</head>
<body>
    <header class="fixed-top bg-transparent shadow-sm">
        <style>
            .top-bar {
                background-color: #C8102E;
                color: white;
                padding: 8px 0;
                width: 100%;
            }
        
            .top-bar .container {
                display: flex;
                justify-content: space-between;
                align-items: center;
                max-width: 1200px;
                margin: 0 auto;
            }
        
            .delivery-text {
                font-size: 14px;
                display: flex;
                align-items: center;
            }
        
            .delivery-text i {
                margin-right: 8px;
            }
        
            .auth-buttons {
                display: flex;
                gap: 15px;
                align-items: center;
            }
        
            .auth-btn {
                padding: 4px 16px;
                border-radius: 50px;
                text-decoration: none;
                font-weight: 500;
                transition: all 0.3s ease;
                font-size: 13px;
                background-color: white;
                color: #C8102E !important;
                display: inline-block;
                line-height: 24px;
            }
        
            .login-btn, .register-btn {
                background-color: white;
                color: #C8102E !important;
                border: none;
            }
        
            .login-btn:hover, .register-btn:hover {
                background-color: #f8f8f8;
                text-decoration: none;
            }
        </style>
        <div class="top-bar">
            <div class="container">
                <div class="delivery-text">
                    <i class="fas fa-truck"></i> Delivering Nationwide. <a href="tel:051111112253" class="text-white fw-bold">051-111-11-2253</a>
                </div>
                <div class="auth-buttons">
                    <a href="/login" class="auth-btn login-btn">Login</a>
                    <a href="/register" class="auth-btn register-btn">Register</a>
                    <a href="/loginadmin" class="auth-btn login-btn">AdminLogin </a>
                    <a href="/registeradmin" class="auth-btn register-btn">AdminRegister</a>
                </div>
            </div>
        </div>
        <nav class="navbar navbar-expand-lg navbar-light bg-transparent text-white py-3">
            <div class="container d-flex justify-content-between align-items-center">
                <div class="d-flex flex-column align-items-start">
                    <div class="d-flex align-items-center">
                        <button class="btn btn-outline-secondary me-3" type="button" data-bs-toggle="offcanvas" data-bs-target="#categoryMenu">
                            <img src="https://tehzeeb.com/static/version1740642958/frontend/Magento/tehzeeb_new/en_US/images/HamburgerMenu.webp" alt="menu" width="30">
                        </button>
                        <div class="d-none d-md-block ">
                            <span class="fw-bold">How do you want your products?</span>
                        </div>
                    </div>
                    <ul class="nav justify-content-start border-top pt-2" style="color: white;">
                        <style>
                            .nav-link{
                                color :white !important;
                            }
                        </style>

                        <li class="nav-item"><a href="/categories/pizza" class="nav-link">Pizza</a></li>
                        <li class="nav-item"><a href="/categories/cakes" class="nav-link">Cakes</a></li>
                        <li class="nav-item"><a href="/categories/biscuits" class="nav-link">Biscuits</a></li>
                        <li class="nav-item"><a href="/categories/pastry" class="nav-link">Pastry</a></li>
                        <li class="nav-item"><a href="/categories/bread" class="nav-link">Bread</a></li>
                        <li class="nav-item"><a href="/categories/puff" class="nav-link">Puffs</a></li>
                    </ul>
                </div>
                <a class="navbar-brand mx-auto" href="/">
                    <img src="https://tehzeeb.com/media/logo/stores/1/Tehzeeb-Logo-PNG1.png" alt="Tehzeeb Bakers" width="150">
                </a>
                <div class="d-flex flex-column align-items-end">
                    <div class="d-flex align-items-center">
                        <a style="text-decoration: none;" href="tel:051111112253" class="text-light me-3 d-flex align-items-center">
                            <!-- <img class="nav-link" src="https://tehzeeb.com/static/version1740642958/frontend/Magento/tehzeeb_new/en_US/images/fluent_call-28-regular.webp" width="30" alt="call"> -->
                            <i class="fa-solid fa-phone nav-link"></i>
                            <span class="ms-2 d-none d-md-inline nav-link">Call Us</span>
                        </a>
                        <% if (user) { %>
                            <a href="/contact" class="text-light me-3 d-flex align-items-center">
                                <i class="fa-solid fa-envelope nav-link"></i>
                                <span class="ms-2 d-none d-md-inline nav-link">Contact Us</span>
                            </a>
                        <% } %>
                        <% if (user) { %>
                            <% if (user.isAdmin === 'admin') { %>
                                <a href="/admin/complaints" class="text-light me-3 d-flex align-items-center">
                                    <i class="fa-solid fa-exclamation-circle nav-link"></i>
                                    <span class="ms-2 d-none d-md-inline nav-link">Complaints</span>
                                </a>
                            <% } else { %>
                                <a href="/complaint" class="text-light me-3 d-flex align-items-center">
                                    <i class="fa-solid fa-exclamation-circle nav-link"></i>
                                    <span class="ms-2 d-none d-md-inline nav-link">Complaint</span>
                                </a>
                            <% } %>
                        <% } %>
                        <button class="btn btn-outline-secondary me-3" type="button" data-bs-toggle="modal" data-bs-target="#searchModal">
                            <img src="https://tehzeeb.com/static/version1740642958/frontend/Magento/tehzeeb_new/en_US/images/searchicon.webp" alt="search" width="25">
                        </button>
                        <% if (user) { %>
                            <% if (user.isAdmin === 'admin') { %>
                                <a href="/admin" class="text-light me-3" title="Admin Panel">
                                    <i style="font-size: 24px; color: white;" class="fa-solid fa-user-shield nav-link"></i>
                                </a>
                            <% } else if (user.isAdmin === 'user') { %>
                                <a href="/customer/account" class="text-light me-3">
                                    <i style="font-size: 24px; color: white;" class="fa-regular fa-user nav-link"></i>
                                </a>
                            <% } %>
                        <% } %>
                        <!-- <button class="btn btn-outline-secondary position-relative" type="button" data-bs-toggle="offcanvas" data-bs-target="#cartMenu">
                            <img src="https://tehzeeb.com/static/version1740642958/frontend/Magento/tehzeeb_new/en_US/images/cart.webp" alt="cart" width="27">
                            <% if (locals.cart && cart.items.length > 0) { %>
                                <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                                    <%= cart.items.length %>
                                </span>
                            <% } %>
                        </button> -->
                        <button class="btn btn-outline-secondary position-relative" type="button" data-bs-toggle="offcanvas" data-bs-target="#cartMenu">
                            <img src="https://tehzeeb.com/static/version1740642958/frontend/Magento/tehzeeb_new/en_US/images/cart.webp" alt="cart" width="27">
                            <span id="cart-item-count-badge" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" style="display: none;">
                                0
                            </span>
                        </button>
                        
                    </div>
                    <ul class="nav justify-content-end border-top pt-2">
                        <li class="nav-item"><a href="https://tehzeeb.com/ramadan-menu.html/" class="nav-link">
                            <!-- <img src="https://tehzeeb.com/static/version1740642958/frontend/Magento/tehzeeb_new/en_US/images/ramadan.png" alt="Ramadan Icon" style="width: 20px; height: 20px; margin-right: 5px;"> -->
                            <i class="fa-solid fa-mosque nav-link"></i>
                            Ramdan</a></li>
                        <li class="nav-item"><a href="/categories/snack" class="nav-link">DELIVER NATIONWIDE</a></li>
                        <li class="nav-item"><a href="/categories/snack" class="nav-link">Snacks</a></li>
                        <li class="nav-item"><a href="/categories/salad" class="nav-link">Salad</a></li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>
    <div class="offcanvas offcanvas-start d-flex flex-column" id="categoryMenu" tabindex="-1" style="color: black; background-color: #fdf9f3; height: 100vh;">
    <div class="offcanvas-header border-bottom">
        <h5 class="offcanvas-title fw-bold text-uppercase">Categories</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
    </div>
    <div class="offcanvas-body flex-grow-1">
        <nav class="nav flex-column">
            <div class="nav-item dropdown">
                <a class="nav-link1 dropdown-toggle fw-bold" href="#" data-bs-toggle="collapse" data-bs-target="#breadMenu" aria-expanded="false">Bread</a>
                <div class="collapse" id="breadMenu">
                    <ul class="list-unstyled ps-3">
                        <li><a href="https://tehzeeb.com/bread.html" class="nav-link1">All Bread</a></li>
                        <li><a href="https://tehzeeb.com/bread/buns.html" class="nav-link1">Bun</a></li>
                        <li><a href="https://tehzeeb.com/bread/crossiant.html" class="nav-link1">Croissant</a></li>
                        <li><a href="https://tehzeeb.com/bread/rusk.html" class="nav-link1">Rusk</a></li>
                        <li><a href="https://tehzeeb.com/bread/breakfast-bread.html" class="nav-link1">Breakfast Bread</a></li>
                    </ul>
                </div>
            </div>
            <div class="nav-item dropdown">
                <a class="nav-link1 dropdown-toggle fw-bold" href="#" data-bs-toggle="collapse" data-bs-target="#cakeMenu" aria-expanded="false">Cakes</a>
                <div class="collapse" id="cakeMenu">
                    <ul class="list-unstyled ps-3">
                        <li><a href="https://tehzeeb.com/cake.html" class="nav-link1">All Cakes</a></li>
                        <li><a href="https://tehzeeb.com/cake/dry-cake.html" class="nav-link1">Dry Cakes</a></li>
                        <li><a href="https://tehzeeb.com/cake/the-teacake-family.html" class="nav-link1">Teacake</a></li>
                        <li><a href="https://tehzeeb.com/cake/fresh-cream-cake.html" class="nav-link1">Fresh Cream Cake</a></li>
                        <li><a href="https://tehzeeb.com/cake/mousse-cake.html" class="nav-link1">Mousse Cake</a></li>
                        <li><a href="https://tehzeeb.com/cake/butter-cream-cake.html" class="nav-link1">Buttercream Cake</a></li>
                        <li><a href="https://tehzeeb.com/cake/cheesecakes.html" class="nav-link1">Cheesecakes</a></li>
                    </ul>
                </div>
            </div>
            <a href="https://tehzeeb.com/snacks.html" class="nav-link1">Snack</a>
            <a href="https://tehzeeb.com/pizza.html" class="nav-link1">Pizza</a>
            <a href="https://tehzeeb.com/biscuits.html" class="nav-link1">Biscuit</a>
            <div class="nav-item dropdown">
                <a class="nav-link1 dropdown-toggle fw-bold" href="#" data-bs-toggle="collapse" data-bs-target="#pasteryMenu" aria-expanded="false">Pastry</a>
                <div class="collapse" id="pasteryMenu">
                    <ul class="list-unstyled ps-3">
                        <li><a href="https://tehzeeb.com/pastry.html" class="nav-link1">All Pastry</a></li>
                        <li><a href="https://tehzeeb.com/pastry/fresh-cream-pastry.html" class="nav-link1">Fresh Cream Pastery</a></li>
                        <li><a href="https://tehzeeb.com/pastry/mousse-pastry.html" class="nav-link1">Mousse Pastery</a></li>
                        <li><a href="https://tehzeeb.com/pastry/butter-cream-pastry.html" class="nav-link1">Butter Cream Pastery</a></li>
                        <li><a href="https://tehzeeb.com/pastry/brownies.html" class="nav-link1">Brownies</a></li>
                        <li><a href="https://tehzeeb.com/pastry/cheesecake-pastry.html" class="nav-link1">Cheesecake</a></li>
                        <li><a href="https://tehzeeb.com/pastry/sundae-cups.html" class="nav-link1">Sundae Cups</a></li>
                    </ul>
                </div>
            </div>
            <a href="https://tehzeeb.com/donut.html" class="nav-link1">Donut</a>
            <a href="https://tehzeeb.com/salad.html" class="nav-link1">Salad</a>
            <a href="https://tehzeeb.com/burger-amp-sandwich.html" class="nav-link1">Sandwich</a>
            <a href="https://tehzeeb.com/burger.html" class="nav-link1">Burger</a>
            <a href="https://tehzeeb.com/nimko.html" class="nav-link1">Nimko</a>
            <a href="https://tehzeeb.com/puff.html" class="nav-link1">Puff</a>
            <a href="https://tehzeeb.com/gifting.html" class="nav-link1">Gifting</a>
            <a href="https://tehzeeb.com/kanas-ketchup.html" class="nav-link1">Kanas Ketchup</a>
            <a href="https://tehzeeb.com/packed-items.html" class="nav-link1">Packed Items</a>
            <a href="https://tehzeeb.com/royal-biscuits.html" class="nav-link1">Royal Biscuits</a>
            <a href="https://tehzeeb.com/ramadan-menu.html" class="nav-link1">Ramadan Menu</a>
        </nav>
    </div>
    <div class="offcanvas-footer border-top p-3">
        <p class="fw-bold text-uppercase mb-1">Accounts</p>
        <a href="/contact" class="fw-bold text-uppercase text-decoration-none">Contact Us</a>
    </div>
</div>
<div class="modal fade" id="searchModal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Search Tehzeeb</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form action="https://tehzeeb.com/catalogsearch/result/" method="get">
                    <input type="text" name="q" class="form-control" placeholder="Search Tehzeeb" required>
                </form>
            </div>
        </div>
    </div>
</div>
<div class="offcanvas offcanvas-end" id="cartMenu">
    <div class="offcanvas-header border-bottom">
        <h5 class="offcanvas-title">Shopping Cart</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
    </div>
    <!-- <div class="offcanvas-body">
        <% if (!locals.cart || cart.items.length === 0) { %>
            <p class="text-center text-muted">You have no items in your shopping cart.</p>
        <% } else { %>
            <div class="cart-items">
                <% cart.items.forEach(function(item) { %>
                    <div class="card mb-3">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="card-title mb-1"><%= item.name %></h6>
                                    <p class="card-text mb-0">PKR <%= item.price.toFixed(2) %></p>
                                    <div class="quantity-controls mt-2">
                                        <button class="btn btn-sm btn-outline-secondary decrease-quantity" data-product-id="<%= item.productId %>">-</button>
                                        <input type="number" class="form-control form-control-sm d-inline-block mx-2" style="width: 50px;" value="<%= item.quantity %>" min="1" data-product-id="<%= item.productId %>">
                                        <button class="btn btn-sm btn-outline-secondary increase-quantity" data-product-id="<%= item.productId %>">+</button>
                                    </div>
                                </div>
                                <div class="text-end">
                                    <p class="mb-2"><strong>PKR <%= (item.price * item.quantity).toFixed(2) %></strong></p>
                                    <button class="btn btn-sm btn-outline-danger remove-item" data-product-id="<%= item.productId %>">Remove</button>
                                </div>
                            </div>
                        </div>
                    </div>
                <% }); %>
            </div>
            <div class="cart-summary border-top pt-3 mt-3">
                <div class="d-flex justify-content-between mb-3">
                    <h5>Total:</h5>
                    <h5>PKR <%= cart.total.toFixed(2) %></h5>
                </div>
                <div class="d-grid gap-2">
                    <a href="/cart" class="btn btn-outline-secondary">View Cart</a>
                    <a href="/checkoutform" class="btn btn-danger">Proceed to Checkout</a>
                </div>
            </div>
        <% } %>
    </div> -->
    <div class="offcanvas-body">
        <div id="cart-items-container">
            <p class="text-center text-muted" id="empty-cart-message">You have no items in your shopping cart.</p>
            <!-- Offcanvas cart items will be rendered here by index.js -->
        </div>
        <div id="cart-summary" class="border-top pt-3 mt-3" style="display: none;">
            <div class="d-flex justify-content-between mb-2">
                <span>Subtotal:</span>
                <span id="cart-subtotal">PKR 0.00</span>
            </div>
            <div class="d-flex justify-content-between mb-3 fw-bold">
                <h5>Total:</h5>
                <h5 id="cart-total">PKR 0.00</h5>
            </div>
            <div class="d-grid gap-2">
                <button id = view-full-cart-btn href="/viewcart" class="btn btn-outline-secondary">View and Edit Cart</button>
                <button id = proceed-to-checkout-fullcart-btn href="/checkoutform" class="btn btn-danger btn-primary-custom">Proceed to Checkout</button> <!-- Placeholder link -->
            </div>
        </div>
    </div>
</div>
<%- body %>

<footer class="page-footer footer  pt-5"style="background-color: #fdf9f3;">
    <div class="container"  style="background-color: #fdf9f3;">
        <!-- Email Subscription Row -->
        <div class="row mb-4 align-items-center">
            <!-- Left Side: Header & Paragraph -->
            <div class="col-md-6">
                <h2 class="h4">Enter the world of Tehzeeb</h2>
                <p class="mb-3">News, Bakery Creation & Latest events in stores.</p>
            </div>

            <!-- Right Side: Email Subscription Box -->
            <div class="col-md-6 text-md-end">
                <form class="subscribe" novalidate action="https://tehzeeb.com/newsletter/subscriber/new/" method="post" id="newsletter-validate-detail">
                    <div class="input-group">
                        <input type="email" name="email" id="newsletter" class="form-control" placeholder="Enter your email address *" required>
                        <button class="btn custom-brown-btn" type="submit" title="Subscribe" aria-label="Subscribe">
                            <span>Subscribe</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Footer Links Row -->
        <div class="row">
            <!-- Categories -->
            <div class="col-md-3 mb-4">
                <h5 class="footer_title">Categories</h5>
                <div class="row">
                    <div class="col-6">
                        <ul class="list-unstyled footer_list">
                            <li><a href="https://tehzeeb.com/cake.html/" class="footer_link">Cakes</a></li>
                            <li><a href="https://tehzeeb.com/biscuits.html/" class="footer_link">Biscuits</a></li>
                            <li><a href="https://tehzeeb.com/pastry.html/" class="footer_link">Pastries</a></li>
                            <li><a href="https://tehzeeb.com/salad.html/" class="footer_link">Salads</a></li>
                            <li><a href="https://tehzeeb.com/bread.html/" class="footer_link">Bread</a></li>
                        </ul>
                    </div>
                    <div class="col-6">
                        <ul class="list-unstyled footer_list">
                            <li><a href="https://tehzeeb.com/pizza.html/" class="footer_link">Pizzas</a></li>
                            <li><a href="https://tehzeeb.com/donut.html/" class="footer_link">Donuts</a></li>
                            <li><a href="https://tehzeeb.com/snacks.html/" class="footer_link">Snacks</a></li>
                            <li><a href="https://tehzeeb.com/puff.html/" class="footer_link">Puff</a></li>
                            <li><a href="https://tehzeeb.com/bread/buns.html/" class="footer_link">Buns</a></li>
                        </ul>
                    </div>
                </div>
            </div>


            <!-- Company -->
            <div class="col-md-3 mb-4">
                <h5 class="footer_title">Company</h5>
                <ul class="list-unstyled footer_list">
                    <li><a href="https://tehzeeb.com/contactus.html/" class="footer_link">Contact us</a></li>
                    <li><a href="https://tehzeeb.com/about-us/" class="footer_link">About us</a></li>
                    <li><a href="https://tehzeeb.com/terms-and-conditions-1/" class="footer_link">Terms & Conditions</a></li>
                    <li><a href="https://tehzeeb.com/privacy-policy/" class="footer_link">Privacy Policy</a></li>
                </ul>
            </div>
            <!-- Services -->
            <div class="col-md-3 mb-4">
                <h5 class="footer_title">Services</h5>
                <ul class="list-unstyled footer_list">
                    <li><a href="javascript:void(0)" class="footer_link">B2B</a></li>
                    <li><a href="javascript:void(0)" class="footer_link">Art of Gifting</a></li>
                    <li><a href="javascript:void(0)" class="footer_link">Built My Cake</a></li>
                    <li><a href="javascript:void(0)" class="footer_link">Pick up</a></li>
                </ul>
            </div>
            <!-- Quick Links -->
            <div class="col-md-3 mb-4">
                <h5 class="footer_title">Quick Links</h5>
                <ul class="list-unstyled footer_list">
                    <li><a href="https://tehzeeb.com/faqs.html/" class="footer_link">FAQ's</a></li>
                    <li><a href="https://tehzeeb.com/customer/account/index/" class="footer_link">My Account</a></li>
                    <li><a href="https://tehzeeb.com/storepickup/" class="footer_link">Our Stores</a></li>
                </ul>
            </div>
        </div>
        <!-- Social Media & Copyright -->
        <div class="row align-items-center">
            <div class="col-md-12">
                <ul class="list-inline d-flex flex-row justify-content-center align-items-center mb-0">
                    <li class="list-inline-item social_list">
                        <a href="https://www.facebook.com/Tehzeeb.pk/" target="_blank" class="social_item">
                            <svg xmlns="http://www.w3.org/2000/svg" width="13" height="24" fill="none" viewBox="0 0 13 24">
                                <path d="M8.08008 23.5679V13.0302H11.6351L12.1635 8.90436H8.08008V6.27636C8.08008 5.08579 8.4118 4.27064 10.1205 4.27064H12.2857V0.592214C11.2322 0.479317 10.1733 0.424805 9.1138 0.428928C5.97151 0.428928 3.81408 2.34721 3.81408 5.86879V8.89664H0.282227V13.0225H3.8218V23.5679H8.08008Z" fill="#A4854F"></path>
                            </svg>
                        </a>
                    </li>
                    <li class="list-inline-item social_list">
                        <a href="https://www.instagram.com/tehzeeb.pk/?hl=en" target="_blank" class="social_item">
                            <svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" fill="none" viewBox="0 0 26 26">
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M7.70925 0.243992C9.07775 0.180992 9.51408 0.166992 13.0001 0.166992C16.4861 0.166992 16.9224 0.182159 18.2897 0.243992C19.6571 0.305826 20.5904 0.523992 21.4071 0.840159C22.2622 1.16333 23.0381 1.66849 23.6797 2.32183C24.3331 2.96233 24.8371 3.73699 25.1591 4.59333C25.4764 5.40999 25.6934 6.34333 25.7564 7.70833C25.8194 9.07916 25.8334 9.51549 25.8334 13.0003C25.8334 16.4863 25.8182 16.9227 25.7564 18.2912C25.6946 19.6562 25.4764 20.5895 25.1591 21.4062C24.8371 22.2626 24.3322 23.0386 23.6797 23.68C23.0381 24.3333 22.2622 24.8373 21.4071 25.1593C20.5904 25.4767 19.6571 25.6937 18.2921 25.7567C16.9224 25.8197 16.4861 25.8337 13.0001 25.8337C9.51408 25.8337 9.07775 25.8185 7.70925 25.7567C6.34425 25.6948 5.41091 25.4767 4.59425 25.1593C3.73782 24.8373 2.96187 24.3325 2.32041 23.68C1.66752 23.0391 1.16228 22.2635 0.839915 21.4073C0.523748 20.5907 0.306748 19.6573 0.243748 18.2923C0.180748 16.9215 0.166748 16.4852 0.166748 13.0003C0.166748 9.51433 0.181915 9.07799 0.243748 7.71066C0.305581 6.34333 0.523748 5.40999 0.839915 4.59333C1.16276 3.73709 1.66839 2.96152 2.32158 2.32066C2.96213 1.66791 3.7373 1.16268 4.59308 0.840159C5.40975 0.523992 6.34308 0.306992 7.70808 0.243992H7.70925ZM18.1859 2.55399C16.8326 2.49216 16.4266 2.47933 13.0001 2.47933C9.57358 2.47933 9.16758 2.49216 7.81425 2.55399C6.56241 2.61116 5.88341 2.81999 5.43075 2.99616C4.83225 3.22949 4.40408 3.50599 3.95491 3.95516C3.52913 4.36939 3.20146 4.87365 2.99591 5.43099C2.81975 5.88366 2.61091 6.56266 2.55375 7.81449C2.49191 9.16782 2.47908 9.57382 2.47908 13.0003C2.47908 16.4268 2.49191 16.8328 2.55375 18.1862C2.61091 19.438 2.81975 20.117 2.99591 20.5697C3.20125 21.1262 3.52908 21.6313 3.95491 22.0455C4.36908 22.4713 4.87425 22.7992 5.43075 23.0045C5.88341 23.1807 6.56241 23.3895 7.81425 23.4467C9.16758 23.5085 9.57241 23.5213 13.0001 23.5213C16.4277 23.5213 16.8326 23.5085 18.1859 23.4467C19.4377 23.3895 20.1167 23.1807 20.5694 23.0045C21.1679 22.7712 21.5961 22.4947 22.0452 22.0455C22.4711 21.6313 22.7989 21.1262 23.0042 20.5697C23.1804 20.117 23.3892 19.438 23.4464 18.1862C23.5082 16.8328 23.5211 16.4268 23.5211 13.0003C23.5211 9.57382 23.5082 9.16782 23.4464 7.81449C23.3892 6.56266 23.1804 5.88366 23.0042 5.43099C22.7709 4.83249 22.4944 4.40433 22.0452 3.95516C21.631 3.52941 21.1267 3.20174 20.5694 2.99616C20.1167 2.81999 19.4377 2.61116 18.1859 2.55399ZM11.3609 16.9565C12.2764 17.3376 13.2957 17.389 14.2448 17.102C15.194 16.815 16.014 16.2074 16.565 15.3829C17.1159 14.5585 17.3635 13.5683 17.2655 12.5816C17.1675 11.5949 16.7299 10.6728 16.0276 9.97283C15.5799 9.52538 15.0385 9.18277 14.4425 8.96966C13.8464 8.75655 13.2106 8.67825 12.5807 8.74038C11.9507 8.80251 11.3424 9.00353 10.7995 9.32898C10.2566 9.65442 9.79262 10.0962 9.44093 10.6225C9.08925 11.1488 8.85863 11.7465 8.76568 12.3726C8.67273 12.9987 8.71976 13.6377 8.90338 14.2434C9.087 14.8492 9.40264 15.4067 9.82759 15.8758C10.2525 16.345 10.7762 16.714 11.3609 16.9565ZM8.33575 8.33599C8.94828 7.72346 9.67545 7.23758 10.4758 6.90608C11.2761 6.57458 12.1338 6.40396 13.0001 6.40396C13.8663 6.40396 14.7241 6.57458 15.5244 6.90608C16.3247 7.23758 17.0519 7.72346 17.6644 8.33599C18.2769 8.94852 18.7628 9.6757 19.0943 10.476C19.4258 11.2763 19.5964 12.1341 19.5964 13.0003C19.5964 13.8666 19.4258 14.7243 19.0943 15.5246C18.7628 16.325 18.2769 17.0521 17.6644 17.6647C16.4274 18.9017 14.7495 19.5967 13.0001 19.5967C11.2506 19.5967 9.57281 18.9017 8.33575 17.6647C7.09869 16.4276 6.40372 14.7498 8.33575 8.33599ZM21.0594 7.38633C21.2112 7.24314 21.3327 7.07095 21.4168 6.87996C21.5008 6.68897 21.5457 6.48306 21.5487 6.27441C21.5518 6.06577 21.5129 5.85863 21.4345 5.66527C21.356 5.47191 21.2396 5.29625 21.092 5.1487C20.9445 5.00115 20.7688 4.88471 20.5755 4.80626C20.3821 4.72782 20.175 4.68896 19.9663 4.69201C19.7577 4.69505 19.5518 4.73992 19.3608 4.82397C19.1698 4.90802 18.9976 5.02954 18.8544 5.18132C18.5759 5.47653 18.4235 5.86863 18.4294 6.27441C18.4353 6.68019 18.5991 7.06768 18.8861 7.35464C19.1731 7.6416 19.5606 7.80543 19.9663 7.81134C20.3721 7.81726 20.7642 7.6648 21.0594 7.38633ZM8.33575 8.33599C8.94828 7.72346 9.67545 7.23758 10.4758 6.90608C11.2761 6.57458 12.1338 6.40396 13.0001 6.40396C13.8663 6.40396 14.7241 6.57458 15.5244 6.90608C16.3247 7.23758 17.0519 7.72346 17.6644 8.33599C18.2769 8.94852 18.7628 9.6757 19.0943 10.476C19.4258 11.2763 19.5964 12.1341 19.5964 13.0003C19.5964 13.8666 19.4258 14.7243 19.0943 15.5246C18.7628 16.325 18.2769 17.0521 17.6644 17.6647C16.4274 18.9017 14.7495 19.5967 13.0001 19.5967C11.2506 19.5967 9.57281 18.9017 8.33575 17.6647C7.09869 16.4276 6.40372 14.7498 8.33575 8.33599ZM21.0594 7.38633C21.2112 7.24314 21.3327 7.07095 21.4168 6.87996C21.5008 6.68897 21.5457 6.48306 21.5487 6.27441C21.5518 6.06577 21.5129 5.85863 21.4345 5.66527C21.356 5.47191 21.2396 5.29625 21.092 5.1487C20.9445 5.00115 20.7688 4.88471 20.5755 4.80626C20.3821 4.72782 20.175 4.68896 19.9663 4.69201C19.7577 4.69505 19.5518 4.73992 19.3608 4.82397C19.1698 4.90802 18.9976 5.02954 18.8544 5.18132C18.5759 5.47653 18.4235 5.86863 18.4294 6.27441C18.4353 6.68019 18.5991 7.06768 18.8861 7.35464C19.1731 7.6416 19.5606 7.80543 19.9663 7.81134C20.3721 7.81726 20.7642 7.6648 21.0594 7.38633ZM8.33575 8.33599C8.94828 7.72346 9.67545 7.23758 10.4758 6.90608C11.2761 6.57458 12.1338 6.40396 13.0001 6.40396C13.8663 6.40396 14.7241 6.57458 15.5244 6.90608C16.3247 7.23758 17.0519 7.72346 17.6644 8.33599C18.2769 8.94852 18.7628 9.6757 19.0943 10.476C19.4258 11.2763 19.5964 12.1341 19.5964 13.0003C19.5964 13.8666 19.4258 14.7243 19.0943 15.5246C18.7628 16.325 18.2769 17.0521 17.6644 17.6647C16.4274 18.9017 14.7495 19.5967 13.0001 19.5967C11.2506 19.5967 9.57281 18.9017 8.33575 17.6647C7.09869 16.4276 6.40372 14.7498 8.33575 8.33599ZM21.0594 7.38633C21.2112 7.24314 21.3327 7.07095 21.4168 6.87996C21.5008 6.68897 21.5457 6.48306 21.5487 6.27441C21.5518 6.06577 21.5129 5.85863 21.4345 5.66527C21.356 5.47191 21.2396 5.29625 21.092 5.1487C20.9445 5.00115 20.7688 4.88471 20.5755 4.80626C20.3821 4.72782 20.175 4.68896 19.9663 4.69201C19.7577 4.69505 19.5518 4.73992 19.3608 4.82397C19.1698 4.90802 18.9976 5.02954 18.8544 5.18132C18.5759 5.47653 18.4235 5.86863 18.4294 6.27441C18.4353 6.68019 18.5991 7.06768 18.8861 7.35464C19.1731 7.6416 19.5606 7.80543 19.9663 7.81134C20.3721 7.81726 20.7642 7.6648 21.0594 7.38633ZM8.33575 8.33599C8.94828 7.72346 9.67545 7.23758 10.4758 6.90608C11.2761 6.57458 12.1338 6.40396 13.0001 6.40396C13.8663 6.40396 14.7241 6.57458 15.5244 6.90608C16.3247 7.23758 17.0519 7.72346 17.6644 8.33599C18.2769 8.94852 18.7628 9.6757 19.0943 10.476C19.4258 11.2763 19.5964 12.1341 19.5964 13.0003C19.5964 13.8666 19.4258 14.7243 19.0943 15.5246C18.7628 16.325 18.2769 17.0521 17.6644 17.6647C16.4274 18.9017 14.7495 19.5967 13.0001 19.5967C11.2506 19.5967 9.57281 18.9017 8.33575 17.6647C7.09869 16.4276 6.40372 14.7498 8.33575 8.33599ZM21.0594 7.38633C21.2112 7.24314 21.3327 7.07095 21.4168 6.87996C21.5008 6.68897 21.5457 6.48306 21.5487 6.27441C21.5518 6.06577 21.5129 5.85863 21.4345 5.66527C21.356 5.47191 21.2396 5.29625 21.092 5.1487C20.9445 5.00115 20.7688 4.88471 20.5755 4.80626C20.3821 4.72782 20.175 4.68896 19.9663 4.69201C19.7577 4.69505 19.5518 4.73992 19.3608 4.82397C19.1698 4.90802 18.9976 5.02954 18.8544 5.18132C18.5759 5.47653 18.4235 5.86863 18.4294 6.27441C18.4353 6.68019 18.5991 7.06768 18.8861 7.35464C19.1731 7.6416 19.5606 7.80543 19.9663 7.81134C20.3721 7.81726 20.7642 7.6648 21.0594 7.38633ZM8.33575 8.33599C8.94828 7.72346 9.67545 7.23758 10.4758 6.90608C11.2761 6.57458 12.1338 6.40396 13.0001 6.40396C13.8663 6.40396 14.7241 6.57458 15.5244 6.90608C16.3247 7.23758 17.0519 7.72346 17.6644 8.33599C18.2769 8.94852 18.7628 9.6757 19.0943 10.476C19.4258 11.2763 19.5964 12.1341 19.5964 13.0003C19.5964 13.8666 19.4258 14.7243 19.0943 15.5246C18.7628 16.325 18.2769 17.0521 17.6644 17.6647C16.4274 18.9017 14.7495 19.5967 13.0001 19.5967C11.2506 19.5967 9.57281 18.9017 8.33575 17.6647C7.09869 16.4276 6.40372 14.7498 8.33575 8.33599ZM21.0594 7.38633C21.2112 7.24314 21.3327 7.07095 21.4168 6.87996C21.5008 6.68897 21.5457 6.48306 21.5487 6.27441C21.5518 6.06577 21.5129 5.85863 21.4345 5.66527C21.356 5.47191 21.2396 5.29625 21.092 5.1487C20.9445 5.00115 20.7688 4.88471 20.5755 4.80626C20.3821 4.72782 20.175 4.68896 19.9663 4.69201C19.7577 4.69505 19.5518 4.73992 19.3608 4.82397C19.1698 4.90802 18.9976 5.02954 18.8544 5.18132C18.5759 5.47653 18.4235 5.86863 18.4294 6.27441C18.4353 6.68019 18.5991 7.06768 18.8861 7.35464C19.1731 7.6416 19.5606 7.80543 19.9663 7.81134C20.3721 7.81726 20.7642 7.6648 21.0594 7.38633Z" fill="#A4854F"></path>
                            </svg>
                        </a>
                    </li>
                    <li class="list-inline-item social_list">
                        <a href="https://www.pinterest.com/tehzeebbakers/" target="_blank" class="social_item">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
                                <path d="M12 0C5.37 0 0 5.37 0 12c0 4.87 2.92 9.06 7.12 11 0-.83 0-1.82.22-2.72.22-.91 1.5-6.38 1.5-6.38s-.39-.78-.39-1.93c0-1.8 1.04-3.15 2.35-3.15 1.1 0 1.63.83 1.63 1.83 0 1.1-.7 2.75-1.06 4.27-.31 1.34.66 2.44 2 2.44 2.41 0 4.27-2.56 4.27-6.24 0-3.27-2.35-5.58-5.71-5.58-3.9 0-6.21 2.92-6.21 5.94 0 1.1.39 2.27.96 2.91.13.17.13.26.09.48-.09.22-.26.83-.31.96-.09.22-.26.31-.48.17-1.35-.65-2.2-2.73-2.2-4.41 0-3.56 2.74-6.84 7.86-6.84 4.13 0 7.33 2.96 7.33 6.89 0 4.1-2.44 7.36-5.91 7.36-1.14 0-2.26-.61-2.63-1.31l-.72 2.74c-.22.87-.83 1.96-1.24 2.63 1.13.35 2.33.52 3.59.52 6.63 0 12-5.37 12-12S18.63 0 12 0z" fill="#A4854F"/>
                            </svg>
                        </a>
                    </li>
                </ul>
            </div>
            <div class="col-md-12 text-center mt-3">
                <p class="mb-0">&copy; 2025 Your Company Name. All Rights Reserved.</p>
            </div>
        </div>

    </div>
</footer>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        window.addEventListener("scroll", function () {
            let header = document.querySelector("header");
            header.classList.toggle("scrolled", window.scrollY > 50);
        });
        var swiper1 = new Swiper('.mySwiper', {
            loop: true,
            slidesPerView: 4, 
            spaceBetween: 20, 
            navigation: {
                nextEl: '.swiper-button-next',
                prevEl: '.swiper-button-prev',
            },
            pagination: {
                el: '.swiper-pagination',
                clickable: true,
            },
            breakpoints: {
                1200: { slidesPerView: 4 }, 
                992: { slidesPerView: 3 }, 
                768: { slidesPerView: 2 }, 
                480: { slidesPerView: 1 }  
            }
        });
        document.querySelectorAll(".swiper-slide").forEach(slide => {
            let card = slide.querySelector(".card");

            slide.addEventListener("mouseenter", () => {
                card.style.opacity = "1";
            });

            slide.addEventListener("mouseleave", () => {
                card.style.opacity = "0";
            });
            slide.addEventListener("touchstart", () => {
                card.style.opacity = "1";
            });

            slide.addEventListener("touchend", () => {
                setTimeout(() => {
                    card.style.opacity = "0";
                }, 3000); 
            });
        });
    });
    </script>
<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
<script src="/javascripts/index.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Update quantity
    function updateQuantity(productId, newQuantity) {
        fetch('/cart/update', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                productId: productId,
                quantity: newQuantity
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                location.reload();
            }
        })
        .catch(error => console.error('Error:', error));
    }

    // Remove item
    document.querySelectorAll('.remove-item').forEach(button => {
        button.addEventListener('click', function() {
            const productId = this.dataset.productId;
            
            fetch('/cart/remove', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    productId: productId
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    location.reload();
                }
            })
            .catch(error => console.error('Error:', error));
        });
    });

    // Handle cart buttons
    document.getElementById('view-full-cart-btn').addEventListener('click', function() {
        window.location.href = '/viewcart';
    });

    document.getElementById('proceed-to-checkout-fullcart-btn').addEventListener('click', function() {
        window.location.href = '/checkoutform';
    });
});
</script>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

<script>
// Global cartItems array, will be populated from server session
var cartItems = [];

// --- CORE CART DATA AND SERVER SYNC FUNCTIONS ---

/**
 * Fetches the cart from the server session and initializes the client-side cartItems array.
 * This should be called on page load.
 */
async function initializeCart() {
    try {
        const response = await fetch('/cart/items');
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        const data = await response.json();
        if (data.success && Array.isArray(data.cart)) {
            cartItems = data.cart;
        } else {
            console.warn('Failed to initialize cart from server or cart is not an array:', data.message);
            cartItems = [];
        }
    } catch (error) {
        console.error('Error fetching cart items:', error);
        cartItems = []; // Fallback to empty cart on error
    }
    syncCartUpdates(); // Update all UI elements related to the cart
}

/**
 * Adds an item to the cart, both optimistically on the client and by syncing with the server.
 */
async function addItemToCart(productId, productTitle, productPrice, productImage, quantity = 1) {
    // Optimistic UI Update
    const existingItemIndex = cartItems.findIndex(item => item.id === productId);
    if (existingItemIndex > -1) {
        cartItems[existingItemIndex].quantity += quantity;
    } else {
        cartItems.push({
            id: productId,
            title: productTitle,
            price: parseFloat(productPrice),
            quantity: quantity,
            image: productImage
        });
    }
    syncCartUpdates(); // Reflect change immediately in UI

    // Sync with server
    try {
        const serverResponse = await fetch('/cart/add', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ productId, productTitle, productPrice, productImage, quantity })
        });
        const serverData = await serverResponse.json();

        if (serverData.success) {
            console.log('Item added to server cart successfully.');
            // Update badge with server's count to ensure consistency
            updateCartItemCountBadge(serverData.cartItemCount);
            // Optionally, if server modifies the cart (e.g., price rules), re-sync:
            // cartItems = serverData.updatedCart || cartItems;
            // syncCartUpdates();
        } else {
            console.error('Failed to add item to server cart:', serverData.message);
            alert('Error: Could not add item to cart. ' + (serverData.message || ''));
            if (serverData.redirect) window.location.href = serverData.redirect;
            await initializeCart(); // Re-fetch cart to correct optimistic update
        }
    } catch (error) {
        console.error('Network error syncing cart add with server:', error);
        alert('A network error occurred while adding to cart.');
        await initializeCart(); // Re-fetch cart
    }
}

/**
 * Removes an item from the cart, both client-side and server-side.
 */
async function removeItemFromCart(productId) {
    const itemIndex = cartItems.findIndex(i => i.id === productId);
    if (itemIndex > -1) {
        cartItems.splice(itemIndex, 1); // Optimistic remove
        syncCartUpdates();

        // Sync with server
        try {
            const serverResponse = await fetch('/cart/remove', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ productId })
            });
            const serverData = await serverResponse.json();
            if (serverData.success) {
                console.log('Item removed from server cart.');
                updateCartItemCountBadge(serverData.cartItemCount);
            } else {
                console.error('Failed to remove item from server cart:', serverData.message);
                alert('Error removing item. ' + (serverData.message || ''));
                await initializeCart(); // Re-sync
            }
        } catch (error) {
            console.error('Network error syncing cart remove:', error);
            alert('A network error occurred while removing item from cart.');
            await initializeCart(); // Re-sync
        }
    }
}

/**
 * Updates the quantity of an item in the cart, both client-side and server-side.
 */
async function updateCartItemQuantity(productId, newQuantity) {
    newQuantity = parseInt(newQuantity, 10);
    const itemInCart = cartItems.find(item => item.id === productId);

    if (itemInCart) {
        if (newQuantity <= 0) { // If quantity is 0 or less, remove the item
            await removeItemFromCart(productId);
            return;
        }
        itemInCart.quantity = newQuantity; // Optimistic update
        syncCartUpdates();

        // Sync with server
        try {
            const serverResponse = await fetch('/cart/update', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ productId, quantity: newQuantity })
            });
            const serverData = await serverResponse.json();
            if (serverData.success) {
                console.log('Cart item quantity updated on server.');
                updateCartItemCountBadge(serverData.cartItemCount);
            } else {
                console.error('Failed to update item quantity on server:', serverData.message);
                alert('Error updating quantity. ' + (serverData.message || ''));
                await initializeCart(); // Re-sync
            }
        } catch (error) {
            console.error('Network error syncing cart quantity update:', error);
            alert('A network error occurred while updating quantity.');
            await initializeCart(); // Re-sync
        }
    }
}


// --- UI UPDATE FUNCTIONS ---

/**
 * Updates all cart-related UI elements (offcanvas, full cart page, checkout page).
 */
function syncCartUpdates() {
    updateCartOffcanvas();
    updateCartItemCountBadge(); // Can be called without arg to use client-side cartItems

    // Check if the specific page elements are visible before re-rendering
    const fullCartPageEl = document.getElementById('full-cart-page');
    if (fullCartPageEl && fullCartPageEl.style.display === 'block') {
        renderFullCartPage();
    }
    const checkoutPageEl = document.getElementById('checkout-page');
    if (checkoutPageEl && checkoutPageEl.style.display === 'block') {
        renderCheckoutPage();
    }
}

/**
 * Updates the content of the cart offcanvas.
 */
function updateCartOffcanvas() {
    const cartItemsContainer = document.getElementById('cart-items-container');
    const emptyCartMessage = document.getElementById('empty-cart-message');
    const cartSummaryDiv = document.getElementById('cart-summary');
    const cartSubtotalEl = document.getElementById('cart-subtotal');
    const cartTotalEl = document.getElementById('cart-total');

    if (!cartItemsContainer) return; // Exit if the container isn't found
    cartItemsContainer.innerHTML = ''; // Clear previous items

    if (cartItems.length === 0) {
        if (emptyCartMessage) emptyCartMessage.style.display = 'block';
        if (cartSummaryDiv) cartSummaryDiv.style.display = 'none';
        return;
    }

    if (emptyCartMessage) emptyCartMessage.style.display = 'none';
    if (cartSummaryDiv) cartSummaryDiv.style.display = 'block';

    let subtotal = 0;
    cartItems.forEach(item => {
        const itemElement = document.createElement('div');
        itemElement.classList.add('d-flex', 'justify-content-between', 'align-items-center', 'mb-3', 'pb-3', 'border-bottom', 'cart-item-entry');
        itemElement.dataset.productId = item.id;
        const itemTotal = parseFloat(item.price) * item.quantity;
        subtotal += itemTotal;

        itemElement.innerHTML = `
            <div class="d-flex align-items-center">
                <img src="${item.image || 'https://via.placeholder.com/50'}" alt="${item.title}" style="width: 50px; height: 50px; object-fit: cover;" class="me-2 rounded">
                <div>
                    <h6 class="mb-0 small">${item.title}</h6>
                    <small class="text-muted">Qty: ${item.quantity} × PKR ${parseFloat(item.price).toFixed(2)}</small>
                </div>
            </div>
            <div class="text-end">
                <span class="fw-bold small">PKR ${itemTotal.toFixed(2)}</span>
                <button class="btn btn-sm btn-outline-danger ms-2 remove-item-btn-offcanvas" data-product-id="${item.id}" aria-label="Remove item">×</button>
            </div>
        `;
        cartItemsContainer.appendChild(itemElement);
    });

    if (cartSubtotalEl) cartSubtotalEl.textContent = `PKR ${subtotal.toFixed(2)}`;
    if (cartTotalEl) cartTotalEl.textContent = `PKR ${subtotal.toFixed(2)}`; // Assuming no tax/shipping in offcanvas

    // Re-attach event listeners for remove buttons in offcanvas
    document.querySelectorAll('.remove-item-btn-offcanvas').forEach(button => {
        // Remove existing listener to prevent duplicates if any, then add
        const newButton = button.cloneNode(true); // Clone to ensure old listeners are gone
        button.parentNode.replaceChild(newButton, button);
        newButton.addEventListener('click', function() {
            removeItemFromCart(this.dataset.productId);
        });
    });
}

/**
 * Updates the cart item count badge in the header.
 * Can take an optional serverCount to directly set the badge.
 */
function updateCartItemCountBadge(serverCount) {
    const badge = document.getElementById('cart-item-count-badge');
    if (!badge) return;

    const totalItems = serverCount !== undefined ?
        serverCount :
        cartItems.reduce((sum, item) => sum + item.quantity, 0);

    badge.textContent = totalItems;
    badge.style.display = totalItems > 0 ? 'inline-block' : 'none';

    // Also update count on checkout page if it exists
    const checkoutItemCountBadge = document.getElementById('checkout-item-count');
    if (checkoutItemCountBadge) {
        checkoutItemCountBadge.textContent = totalItems;
    }
}


// --- PAGE NAVIGATION AND RENDERING LOGIC (SPA-like for Cart/Checkout) ---
function showMainPageContent() {
    const mainPageSections = document.getElementById('main-page-sections');
    const fullCartPage = document.getElementById('full-cart-page');
    const checkoutPage = document.getElementById('checkout-page');

    if(mainPageSections) mainPageSections.style.display = 'block';
    if(fullCartPage) fullCartPage.style.display = 'none';
    if(checkoutPage) checkoutPage.style.display = 'none';
    window.scrollTo(0, 0);
}

function adjustPagePadding(pageElement) {
    const headerElement = document.querySelector("header.fixed-top");
    if (pageElement && headerElement) {
        const headerHeight = headerElement.offsetHeight;
        pageElement.style.paddingTop = `${headerHeight + 20}px`; // 20px buffer
    }
}

function showFullCartPage() {
    const mainPageSections = document.getElementById('main-page-sections');
    const fullCartPage = document.getElementById('full-cart-page');
    const checkoutPage = document.getElementById('checkout-page');

    if(mainPageSections) mainPageSections.style.display = 'none';
    if(fullCartPage) {
        adjustPagePadding(fullCartPage);
        fullCartPage.style.display = 'block';
    }
    if(checkoutPage) checkoutPage.style.display = 'none';
    renderFullCartPage();
    window.scrollTo(0, 0);
}

function showCheckoutPage() {
    if (cartItems.length === 0) {
        alert("Your cart is empty. Please add items before proceeding to checkout.");
        showFullCartPage(); // Or show main page: showMainPageContent();
        return;
    }
    const mainPageSections = document.getElementById('main-page-sections');
    const fullCartPage = document.getElementById('full-cart-page');
    const checkoutPage = document.getElementById('checkout-page');

    if(mainPageSections) mainPageSections.style.display = 'none';
    if(fullCartPage) fullCartPage.style.display = 'none';
    if(checkoutPage) {
         adjustPagePadding(checkoutPage);
         checkoutPage.style.display = 'block';
    }
    renderCheckoutPage();
    window.scrollTo(0, 0);
}

// Full Cart Page Rendering Logic
function renderFullCartPage() {
    const container = document.getElementById('full-cart-items-container');
    const emptyMsg = document.getElementById('full-cart-empty-message');
    const summaryActions = document.getElementById('full-cart-summary-and-actions');

    if (!container) return;
    container.innerHTML = ''; // Clear previous items

    if (cartItems.length === 0) {
        if(emptyMsg) emptyMsg.style.display = 'block';
        if(summaryActions) summaryActions.style.display = 'none';
        if(container) container.style.display = 'none'; // Hide the items container itself
    } else {
        if(emptyMsg) emptyMsg.style.display = 'none';
        if(summaryActions) summaryActions.style.display = 'flex'; // It's a row
        if(container) container.style.display = 'block';

        cartItems.forEach(item => {
            const itemEl = document.createElement('div');
            itemEl.classList.add('card', 'mb-3', 'shadow-sm', 'border-0');
            itemEl.dataset.productId = item.id;
            itemEl.innerHTML = `
                <div class="row g-0">
                    <div class="col-md-2 col-3 d-flex align-items-center justify-content-center p-3">
                        <img src="${item.image || 'https://via.placeholder.com/120'}" class="img-fluid rounded" alt="${item.title}" style="max-height: 100px; object-fit: contain;">
                    </div>
                    <div class="col-md-10 col-9">
                        <div class="card-body p-md-3 p-2">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <h5 class="card-title mb-0">${item.title}</h5>
                                <button class="btn btn-sm btn-outline-danger remove-full-cart-item border-0" data-product-id="${item.id}" title="Remove"><i class="fas fa-times"></i></button>
                            </div>
                            <p class="card-text text-muted mb-2 small">Price: PKR ${parseFloat(item.price).toFixed(2)}</p>
                            <div class="d-flex align-items-center my-2 quantity-controls">
                                <label for="qty-full-${item.id}" class="form-label me-2 mb-0 small d-none d-sm-inline">Quantity:</label>
                                <div class="input-group input-group-sm" style="max-width: 130px;">
                                    <button class="btn btn-outline-secondary decrease-full-qty" type="button" data-product-id="${item.id}">-</button>
                                    <input type="number" class="form-control text-center full-item-qty" value="${item.quantity}" min="0" id="qty-full-${item.id}" data-product-id="${item.id}">
                                    <button class="btn btn-outline-secondary increase-full-qty" type="button" data-product-id="${item.id}">+</button>
                                </div>
                            </div>
                            <p class="card-text fw-bold mt-2">Item Total: PKR <span class="full-item-total">${(parseFloat(item.price) * item.quantity).toFixed(2)}</span></p>
                        </div>
                    </div>
                </div>`;
            container.appendChild(itemEl);
        });
        updateFullCartSummaryDisplay();
        attachFullCartEventListeners();
    }
}

function attachFullCartEventListeners() {
    // Ensure listeners are fresh by cloning or specific removal if elements are not fully re-rendered
    document.querySelectorAll('.remove-full-cart-item').forEach(btn => {
        const newBtn = btn.cloneNode(true); btn.parentNode.replaceChild(newBtn, btn);
        newBtn.addEventListener('click', (e) => removeItemFromCart(e.currentTarget.dataset.productId));
    });
    document.querySelectorAll('.decrease-full-qty').forEach(btn => {
        const newBtn = btn.cloneNode(true); btn.parentNode.replaceChild(newBtn, btn);
        newBtn.addEventListener('click', (e) => {
            const productId = e.currentTarget.dataset.productId;
            const currentItem = cartItems.find(item => item.id === productId);
            if (currentItem) updateCartItemQuantity(productId, currentItem.quantity - 1);
        });
    });
    document.querySelectorAll('.increase-full-qty').forEach(btn => {
        const newBtn = btn.cloneNode(true); btn.parentNode.replaceChild(newBtn, btn);
        newBtn.addEventListener('click', (e) => {
            const productId = e.currentTarget.dataset.productId;
            const currentItem = cartItems.find(item => item.id === productId);
            if (currentItem) updateCartItemQuantity(productId, currentItem.quantity + 1);
        });
    });
    document.querySelectorAll('.full-item-qty').forEach(input => {
        const newInput = input.cloneNode(true); input.parentNode.replaceChild(newInput, input);
        newInput.addEventListener('change', (e) => { // Using 'change' is often better than 'input' for number fields after focus loss
            updateCartItemQuantity(e.currentTarget.dataset.productId, parseInt(e.currentTarget.value, 10));
        });
    });
}

function updateFullCartSummaryDisplay() {
    let subtotal = 0;
    cartItems.forEach(item => { subtotal += parseFloat(item.price) * item.quantity; });

    const subtotalEl = document.getElementById('full-cart-subtotal');
    const grandTotalEl = document.getElementById('full-cart-grand-total');
    if(subtotalEl) subtotalEl.textContent = `PKR ${subtotal.toFixed(2)}`;
    if(grandTotalEl) grandTotalEl.textContent = `PKR ${subtotal.toFixed(2)}`; // Assuming no tax/shipping in this view
}

// Checkout Page Rendering Logic
function renderCheckoutPage() {
    const summaryItemsContainer = document.getElementById('checkout-cart-summary-items');
    const grandTotalEl = document.getElementById('checkout-grand-total');
    const itemCountBadge = document.getElementById('checkout-item-count'); // This is also updated by updateCartItemCountBadge

    if (!summaryItemsContainer || !grandTotalEl) return;

    summaryItemsContainer.innerHTML = '';
    let subtotal = 0;

    if (cartItems.length === 0) { // Should be caught by showCheckoutPage, but good to double check
        showFullCartPage(); // Or some other appropriate action
        return;
    }

    cartItems.forEach(item => {
        const itemPrice = parseFloat(item.price);
        const itemTotal = itemPrice * item.quantity;
        subtotal += itemTotal;

        const listItem = document.createElement('li');
        listItem.classList.add('list-group-item', 'd-flex', 'justify-content-between', 'lh-sm');
        listItem.innerHTML = `
            <div>
                <h6 class="my-0">${item.title}</h6>
                <small class="text-muted">Qty: ${item.quantity} × PKR ${itemPrice.toFixed(2)}</small>
            </div>
            <span class="text-muted">PKR ${itemTotal.toFixed(2)}</span>
        `;
        summaryItemsContainer.appendChild(listItem);
    });

    grandTotalEl.textContent = `PKR ${subtotal.toFixed(2)}`;
    // itemCountBadge is already handled by updateCartItemCountBadge via syncCartUpdates
}


// --- DOMContentLoaded: INITIALIZATION AND EVENT LISTENERS ---
document.addEventListener("DOMContentLoaded", function () {
    // Initialize the cart from server session first
    initializeCart().then(() => {
        console.log("Client-side cart initialized.");
        // Attach event listeners that depend on cart or UI elements
        attachGlobalEventListeners();
    });

    // Header scroll effect
    const header = document.querySelector("header.fixed-top");
    window.addEventListener("scroll", function () {
        if (header) {
            header.classList.toggle("scrolled", window.scrollY > 50);
        }
    });

    // Swiper initialization (if Swiper lib is present)
    if (typeof Swiper !== 'undefined') {
        new Swiper('.mySwiper', { /* ... swiper options ... */
            loop: true, slidesPerView: 4, spaceBetween: 20,
            navigation: { nextEl: '.swiper-button-next', prevEl: '.swiper-button-prev', },
            pagination: { el: '.swiper-pagination', clickable: true, },
            breakpoints: {
                1200: { slidesPerView: 4 }, 992: { slidesPerView: 3 },
                768: { slidesPerView: 2 }, 480: { slidesPerView: 1 }
            }
        });
        document.querySelectorAll(".swiper-slide").forEach(slide => {
            let card = slide.querySelector(".cardofslider"); // Assuming this class exists on hover cards
            if (card) {
                slide.addEventListener("mouseenter", () => { card.style.opacity = "1"; });
                slide.addEventListener("mouseleave", () => { card.style.opacity = "0"; });
                slide.addEventListener("touchstart", () => { card.style.opacity = "1"; }, {passive: true});
                slide.addEventListener("touchend", () => { setTimeout(() => { card.style.opacity = "0"; }, 3000); });
            }
        });
    }
});

/**
 * Attaches event listeners to globally available elements.
 */
function attachGlobalEventListeners() {
    // "Add to Cart" buttons (delegation might be better if products are dynamically loaded often)
    document.querySelectorAll('.add-to-cart-btn').forEach(button => {
        button.addEventListener('click', function() {
            addItemToCart(
                this.dataset.productId,
                this.dataset.productTitle,
                this.dataset.productPrice,
                this.dataset.productImage || this.closest('.product-card,.swiper-slide')?.querySelector('.product-image')?.src
            );
        });
    });

    // Logo link
    const logoLink = document.getElementById('logo-link'); // Make sure your logo has this ID
    if (logoLink) {
        logoLink.addEventListener('click', (e) => { e.preventDefault(); showMainPageContent(); });
    }

    // Page navigation buttons
    const viewFullCartBtn = document.getElementById('view-full-cart-btn'); // In offcanvas
    const viewFullCartLink = document.querySelector('a[href="/viewcart"]'); // General link to view cart
    const continueShoppingEmptyBtn = document.getElementById('continue-shopping-from-empty-cart');
    const continueShoppingSummaryBtn = document.getElementById('continue-shopping-from-summary');
    const proceedToCheckoutOffcanvasBtn = document.querySelector('#cartMenu .btn-danger'); // More specific selector
    const proceedToCheckoutFullCartBtn = document.getElementById('proceed-to-checkout-fullcart-btn');
    const backToCartBtn = document.getElementById('back-to-cart-btn'); // On checkout page

    if (viewFullCartBtn) { // From offcanvas
        viewFullCartBtn.addEventListener('click', (e) => {
            e.preventDefault();
            const cartMenuOffcanvasEl = document.getElementById('cartMenu');
            bootstrap.Offcanvas.getInstance(cartMenuOffcanvasEl)?.hide();
            showFullCartPage();
        });
    }
    if (viewFullCartLink) { // General link to view cart (e.g. from nav or footer)
        viewFullCartLink.addEventListener('click', (e) => {
            e.preventDefault();
             const cartMenuOffcanvasEl = document.getElementById('cartMenu');
            if (cartMenuOffcanvasEl && bootstrap.Offcanvas.getInstance(cartMenuOffcanvasEl)?.show) {
                 bootstrap.Offcanvas.getInstance(cartMenuOffcanvasEl).hide();
            }
            showFullCartPage();
        });
    }

    if (continueShoppingEmptyBtn) continueShoppingEmptyBtn.addEventListener('click', (e) => { e.preventDefault(); showMainPageContent(); });
    if (continueShoppingSummaryBtn) continueShoppingSummaryBtn.addEventListener('click', (e) => { e.preventDefault(); showMainPageContent(); });

    if (proceedToCheckoutOffcanvasBtn) {
        proceedToCheckoutOffcanvasBtn.addEventListener('click', (e) => {
            e.preventDefault();
            const cartMenuOffcanvasEl = document.getElementById('cartMenu');
            bootstrap.Offcanvas.getInstance(cartMenuOffcanvasEl)?.hide();
            showCheckoutPage();
        });
    }
    if (proceedToCheckoutFullCartBtn) {
        proceedToCheckoutFullCartBtn.addEventListener('click', async (e) => {
            e.preventDefault();
            // Check if user is logged in
            // if (!window.user) {
            //     alert('Please login to proceed to checkout');
            //     window.location.href = '/login';
            //     return;
            // }

            // Check if cart has items
            if (!window.cartItems || window.cartItems.length === 0) {
                alert('Your cart is empty! Please add items to proceed.');
                return;
            }

            // Redirect to checkout page
            window.location.href = '/checkoutform';
        });
    }
    if (backToCartBtn) {
        backToCartBtn.addEventListener('click', (e) => { e.preventDefault(); showFullCartPage(); });
    }

    // Checkout Form Submission
    const checkoutForm = document.getElementById('checkout-form');
    if (checkoutForm) {
        checkoutForm.addEventListener('submit', async function(event) {
            event.preventDefault();
            event.stopPropagation();

            if (!checkoutForm.checkValidity()) {
                checkoutForm.classList.add('was-validated');
                return;
            }
            checkoutForm.classList.add('was-validated');

            const formData = {
                phone: document.getElementById('phone').value,
                address: document.getElementById('address').value,
                city: document.getElementById('city').value, // Assuming you add these fields
                state: document.getElementById('state').value, // Assuming you add these fields
                zip: document.getElementById('zip').value,   // Assuming you add these fields
                paymentMethod: document.querySelector('input[name="paymentMethod"]:checked').id,
                // Add other fields as needed by your /api/orders/place endpoint
                // e.g., fullName: document.getElementById('fullName').value,
            };

            try {
                const response = await fetch('/api/orders/place', { // Ensure this matches your server route
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData) // Send only form data, cart is in session
                });
                const result = await response.json();

                if (result.success) {
                    alert(`Thank you! Your order #${result.order ? result.order._id : ''} has been placed.`);
                    cartItems = []; // Clear client-side cart
                    await initializeCart(); // This will effectively clear and re-sync an empty cart
                    checkoutForm.reset();
                    checkoutForm.classList.remove('was-validated');
                    // Redirect to a success page or main page
                    if (result.order && result.order._id) {
                         window.location.href = `/order/success?orderId=${result.order._id}`;
                    } else {
                        showMainPageContent();
                    }
                } else {
                    alert('Error placing order: ' + (result.message || 'Please try again.'));
                     if (result.redirect) window.location.href = result.redirect;
                }
            } catch (error) {
                console.error('Error submitting checkout form:', error);
                alert('An unexpected error occurred. Please try again.');
            }
        });
    }
}
</script>


<style>
.quantity-controls {
    display: flex;
    align-items: center;
}

.quantity-controls input {
    text-align: center;
}

.cart-items {
    max-height: calc(100vh - 250px);
    overflow-y: auto;
}

.badge {
    font-size: 0.6rem;
    padding: 0.35em 0.5em;
}

.btn-outline-secondary {
    border-color: #dee2e6;
}

.btn-outline-secondary:hover {
    background-color: #f8f9fa;
    border-color: #dee2e6;
}

.offcanvas {
    max-width: 400px;
}
</style>
</body>
</html>